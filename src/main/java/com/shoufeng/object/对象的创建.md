# 对象的创建

虚拟机遇到一条**new指令**时，首先就去检查这个指令的参数是否能在**常量池**中定位到一个类的**符号引用**，并且检查这个符号引用代表的类是否已经被**加载**、**解析**和**初始化**过。如果没有，那必须先执行相应的类加载过程。

在类加载检查通过后，接下来虚拟机将为**新生对象分配内存**。

**内存大小**：类加载完成后便可完全确定

**分配内存方式**：

1、**指针碰撞**：前提是堆内存中的空闲空间十分的**规整**，使用与未使用的空间全部为连续，只需移动一下指针就可以了

**serial、parnew**等待**compact**方式的收集器，采用**指针碰撞**。

2、**空闲列表**：针对堆内存中的空间零散的存在，虚拟机维护着一个列表，记录着哪里被分配了，哪里还空闲

**CMS**这种基于**mark-sweep**算法的收集器，采用空闲列表。

```java
CAS 命令的方式来控制操作是同步的
TLAB（Thread Local Allocation Buffer）：虚拟机参数 -XX:UseTLAB 在堆中为每一个线程分配一小块独立的内存，这样以来就不存并发问题了，Java 层面与之对应的是 ThreadLocal 类的实现
```

分配完内存后要对对象的头（Object Header）进行初始化，这新信息包括：该对象对应类的元数据、该对象的GC代、对象的哈希码
最后，一个新对象的产生后还需要执行构造器中的命令，来完成Java层面的初始化，在 JVM 里为 方法。到此一个新生的对象就产生了出来，准备被使用。